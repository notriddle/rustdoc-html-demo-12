<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Routines for comparing and diffing output."><title>cargo_test_support::compare - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-d33be337707cc2ad.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="cargo_test_support" data-themes="" data-resource-suffix="" data-rustdoc-version="1.83.0-dev" data-channel="nightly" data-search-js="search-1654b55072aa070c.js" data-settings-js="settings-805db61a62df4bd2.js" ><script src="../../static.files/storage-1d39b6787ed640ff.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-54bc299d2a5e4e43.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-0111fcff984fae8f.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../cargo_test_support/index.html">cargo_<wbr>test_<wbr>support</a><span class="version">1.83.0-dev</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module compare</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#deprecated-comparisons" title="Deprecated comparisons">Deprecated comparisons</a><ul><li><a href="#patterns" title="Patterns">Patterns</a></li><li><a href="#normalization" title="Normalization">Normalization</a></li></ul></li></ul><h3><a href="#macros">Module Items</a></h3><ul class="block"><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate cargo_<wbr>test_<wbr>support</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><span class="rustdoc-breadcrumbs"><a href="../index.html">cargo_test_support</a></span><h1>Module <span>compare</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/cargo_test_support/compare.rs.html#1-1012">source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Routines for comparing and diffing output.</p>
<h2 id="deprecated-comparisons"><a class="doc-anchor" href="#deprecated-comparisons">§</a>Deprecated comparisons</h2>
<p>Cargo’s tests are in transition from internal-only pattern and normalization routines used in
asserts like <a href="../struct.Execs.html#method.with_stdout" title="method cargo_test_support::Execs::with_stdout"><code>crate::Execs::with_stdout</code></a> to <a href="fn.assert_e2e.html" title="fn cargo_test_support::compare::assert_e2e"><code>assert_e2e</code></a> and <a href="fn.assert_ui.html" title="fn cargo_test_support::compare::assert_ui"><code>assert_ui</code></a>.</p>
<h3 id="patterns"><a class="doc-anchor" href="#patterns">§</a>Patterns</h3>
<p>Many of these functions support special markup to assist with comparing
text that may vary or is otherwise uninteresting for the test at hand. The
supported patterns are:</p>
<ul>
<li><code>[..]</code> is a wildcard that matches 0 or more characters on the same line
(similar to <code>.*</code> in a regex). It is non-greedy.</li>
<li><code>[EXE]</code> optionally adds <code>.exe</code> on Windows (empty string on other
platforms).</li>
<li><code>[ROOT]</code> is the path to the test directory’s root.</li>
<li><code>[CWD]</code> is the working directory of the process that was run.</li>
<li>There is a wide range of substitutions (such as <code>[COMPILING]</code> or
<code>[WARNING]</code>) to match cargo’s “status” output and allows you to ignore
the alignment. See the source of <code>substitute_macros</code> for a complete list
of substitutions.</li>
<li><code>[DIRTY-MSVC]</code> (only when the line starts with it) would be replaced by
<code>[DIRTY]</code> when <code>cfg(target_env = "msvc")</code> or the line will be ignored otherwise.
Tests that work around <a href="https://github.com/rust-lang/cargo/issues/7358">issue 7358</a>
can use this to avoid duplicating the <code>with_stderr</code> call like:
<code>if cfg!(target_env = "msvc") {e.with_stderr("...[DIRTY]...");} else {e.with_stderr("...");}</code>.</li>
</ul>
<h3 id="normalization"><a class="doc-anchor" href="#normalization">§</a>Normalization</h3>
<p>In addition to the patterns described above, the strings are normalized
in such a way to avoid unwanted differences. The normalizations are:</p>
<ul>
<li>Raw tab characters are converted to the string <code>&lt;tab&gt;</code>. This is helpful
so that raw tabs do not need to be written in the expected string, and
to avoid confusion of tabs vs spaces.</li>
<li>Backslashes are converted to forward slashes to deal with Windows paths.
This helps so that all tests can be written assuming forward slashes.
Other heuristics are applied to try to ensure Windows-style paths aren’t
a problem.</li>
<li>Carriage returns are removed, which can help when running on Windows.</li>
</ul>
</div></details><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="macro" href="macro.regex.html" title="macro cargo_test_support::compare::regex">regex</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">This makes it easier to write regex replacements that are guaranteed to only
get compiled once</div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.WildStr.html" title="struct cargo_test_support::compare::WildStr">WildStr</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">A single line string that supports <code>[..]</code> wildcard matching.</div></li></ul><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="static" href="static.E2E_LITERAL_REDACTIONS.html" title="static cargo_test_support::compare::E2E_LITERAL_REDACTIONS">E2E_<wbr>LITERA<wbr>L_<wbr>REDACTIONS</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="static" href="static.MIN_LITERAL_REDACTIONS.html" title="static cargo_test_support::compare::MIN_LITERAL_REDACTIONS">MIN_<wbr>LITERA<wbr>L_<wbr>REDACTIONS</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.add_regex_redactions.html" title="fn cargo_test_support::compare::add_regex_redactions">add_<wbr>regex_<wbr>redactions</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.add_test_support_redactions.html" title="fn cargo_test_support::compare::add_test_support_redactions">add_<wbr>test_<wbr>support_<wbr>redactions</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.assert_e2e.html" title="fn cargo_test_support::compare::assert_e2e">assert_<wbr>e2e</a></div><div class="desc docblock-short">Assertion policy for functional end-to-end tests</div></li><li><div class="item-name"><a class="fn" href="fn.assert_match_exact.html" title="fn cargo_test_support::compare::assert_match_exact">assert_<wbr>match_<wbr>exact</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Convenience wrapper around <a href="fn.match_exact.html" title="fn cargo_test_support::compare::match_exact"><code>match_exact</code></a> which will panic on error.</div></li><li><div class="item-name"><a class="fn" href="fn.assert_ui.html" title="fn cargo_test_support::compare::assert_ui">assert_<wbr>ui</a></div><div class="desc docblock-short">Assertion policy for UI tests</div></li><li><div class="item-name"><a class="fn" href="fn.collect_json_objects.html" title="fn cargo_test_support::compare::collect_json_objects">collect_<wbr>json_<wbr>objects</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.find_json_mismatch.html" title="fn cargo_test_support::compare::find_json_mismatch">find_<wbr>json_<wbr>mismatch</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Compares JSON object for approximate equality.
You can use <code>[..]</code> wildcard in strings (useful for OS-dependent things such
as paths). You can use a <code>"{...}"</code> string literal as a wildcard for
arbitrary nested JSON (useful for parts of object emitted by other programs
(e.g., rustc) rather than Cargo itself).</div></li><li><div class="item-name"><a class="fn" href="fn.find_json_mismatch_r.html" title="fn cargo_test_support::compare::find_json_mismatch_r">find_<wbr>json_<wbr>mismatch_<wbr>r</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.match_contains.html" title="fn cargo_test_support::compare::match_contains">match_<wbr>contains</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string contains the given contiguous lines
somewhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_contains_n.html" title="fn cargo_test_support::compare::match_contains_n">match_<wbr>contains_<wbr>n</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string contains the given contiguous lines
somewhere, and should be repeated <code>number</code> times.</div></li><li><div class="item-name"><a class="fn" href="fn.match_does_not_contain.html" title="fn cargo_test_support::compare::match_does_not_contain">match_<wbr>does_<wbr>not_<wbr>contain</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string does not contain the given contiguous lines
anywhere.</div></li><li><div class="item-name"><a class="fn" href="fn.match_exact.html" title="fn cargo_test_support::compare::match_exact">match_<wbr>exact</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Compares one string against another, checking that they both match.</div></li><li><div class="item-name"><a class="fn" href="fn.match_json.html" title="fn cargo_test_support::compare::match_json">match_<wbr>json</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string of JSON objects match the given set of
expected JSON objects.</div></li><li><div class="item-name"><a class="fn" href="fn.match_json_contains_unordered.html" title="fn cargo_test_support::compare::match_json_contains_unordered">match_<wbr>json_<wbr>contains_<wbr>unordered</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string of JSON objects match the given set of
expected JSON objects, ignoring their order.</div></li><li><div class="item-name"><a class="fn" href="fn.match_unordered.html" title="fn cargo_test_support::compare::match_unordered">match_<wbr>unordered</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string contains the given lines, ignoring the order
of the lines.</div></li><li><div class="item-name"><a class="fn" href="fn.match_with_without.html" title="fn cargo_test_support::compare::match_with_without">match_<wbr>with_<wbr>without</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Checks that the given string has a line that contains the given patterns,
and that line also does not contain the <code>without</code> patterns.</div></li><li><div class="item-name"><a class="fn" href="fn.meta_cmp.html" title="fn cargo_test_support::compare::meta_cmp">meta_<wbr>cmp</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.normalize_actual.html" title="fn cargo_test_support::compare::normalize_actual">normalize_<wbr>actual</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Normalizes the output so that it can be compared against the expected value.</div></li><li><div class="item-name"><a class="fn" href="fn.normalize_expected.html" title="fn cargo_test_support::compare::normalize_expected">normalize_<wbr>expected</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Normalizes the expected string so that it can be compared against the actual output.</div></li><li><div class="item-name"><a class="fn" href="fn.normalize_windows.html" title="fn cargo_test_support::compare::normalize_windows">normalize_<wbr>windows</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="desc docblock-short">Normalizes text for both actual and expected strings on Windows.</div></li><li><div class="item-name"><a class="fn" href="fn.replace_dirty_msvc.html" title="fn cargo_test_support::compare::replace_dirty_msvc">replace_<wbr>dirty_<wbr>msvc</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.replace_dirty_msvc_impl.html" title="fn cargo_test_support::compare::replace_dirty_msvc_impl">replace_<wbr>dirty_<wbr>msvc_<wbr>impl</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li><li><div class="item-name"><a class="fn" href="fn.substitute_macros.html" title="fn cargo_test_support::compare::substitute_macros">substitute_<wbr>macros</a><span title="Restricted Visibility">&nbsp;🔒</span> </div></li></ul></section></div></main></body></html>