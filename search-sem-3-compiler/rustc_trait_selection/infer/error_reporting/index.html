<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Error Reporting Code for the inference engine"><title>rustc_trait_selection::infer::error_reporting - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-0c9465bb72ad079c.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="rustc_trait_selection" data-themes="" data-resource-suffix="" data-rustdoc-version="1.81.0-dev" data-channel="nightly" data-search-js="search-33e1eb393c958316.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-ffff35d1e1849984.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../../rustc_trait_selection/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../../rustc_trait_selection/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2><a href="../../../rustc_trait_selection/index.html">rustc_trait_selection</a><span class="version">1.81.0-dev</span></h2></div><h2 class="location"><a href="#">Module error_reporting</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In rustc_trait_selection::infer</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">rustc_trait_selection</a>::<wbr><a href="../index.html">infer</a>::<wbr><a class="mod" href="#">error_reporting</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../../src/rustc_infer/infer/mod.rs.html#56">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Error Reporting Code for the inference engine</p>
<p>Because of the way inference, and in particular region inference,
works, it often happens that errors are not detected until far after
the relevant line of code has been type-checked. Therefore, there is
an elaborate system to track why a particular constraint in the
inference graph arose so that we can explain to the user what gave
rise to a particular error.</p>
<p>The system is based around a set of “origin” types. An “origin” is the
reason that a constraint or inference variable arose. There are
different “origin” enums for different kinds of constraints/variables
(e.g., <code>TypeOrigin</code>, <code>RegionVariableOrigin</code>). An origin always has
a span, but also more information so that we can generate a meaningful
error message.</p>
<p>Having a catalog of all the different reasons an error can arise is
also useful for other reasons, like cross-referencing FAQs etc, though
we are not really taking advantage of this yet.</p>
<h2 id="region-inference"><a class="doc-anchor" href="#region-inference">§</a>Region Inference</h2>
<p>Region inference is particularly tricky because it always succeeds “in
the moment” and simply registers a constraint. Then, at the end, we
can compute the full graph and report errors, so we need to be able to
store and later report what gave rise to the conflicting constraints.</p>
<h2 id="subtype-trace"><a class="doc-anchor" href="#subtype-trace">§</a>Subtype Trace</h2>
<p>Determining whether <code>T1 &lt;: T2</code> often involves a number of subtypes and
subconstraints along the way. A “TypeTrace” is an extended version
of an origin that traces the types and other values that were being
compared. It is not necessarily comprehensive (in fact, at the time of
this writing it only tracks the root values being compared) but I’d
like to extend it to include significant “waypoints”. For example, if
you are comparing <code>(T1, T2) &lt;: (T3, T4)</code>, and the problem is that <code>T2 &lt;: T4</code> fails, I’d like the trace to include enough information to say
“in the 2nd element of the tuple”. Similarly, failures when comparing
arguments or return types in fn types should be able to cite the
specific position, etc.</p>
<h2 id="reality-vs-plan"><a class="doc-anchor" href="#reality-vs-plan">§</a>Reality vs plan</h2>
<p>Of course, there is still a LOT of code in typeck that has yet to be
ported to this system, and which relies on string concatenation at the
time of error detection.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="nice_region_error/index.html" title="mod rustc_trait_selection::infer::error_reporting::nice_region_error">nice_region_error</a></div></li><li><div class="item-name"><a class="mod" href="sub_relations/index.html" title="mod rustc_trait_selection::infer::error_reporting::sub_relations">sub_relations</a></div></li></ul><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.ObligationCauseAsDiagArg.html" title="struct rustc_trait_selection::infer::error_reporting::ObligationCauseAsDiagArg">ObligationCauseAsDiagArg</a></div><div class="desc docblock-short">Newtype to allow implementing IntoDiagArg</div></li><li><div class="item-name"><a class="struct" href="struct.TypeErrCtxt.html" title="struct rustc_trait_selection::infer::error_reporting::TypeErrCtxt">TypeErrCtxt</a></div><div class="desc docblock-short">A helper for building type related errors. The <code>typeck_results</code>
field is only populated during an in-progress typeck.
Get an instance by calling <code>InferCtxt::err_ctxt</code> or <code>FnCtxt::err_ctxt</code>.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.FailureCode.html" title="enum rustc_trait_selection::infer::error_reporting::FailureCode">FailureCode</a></div></li><li><div class="item-name"><a class="enum" href="enum.TyCategory.html" title="enum rustc_trait_selection::infer::error_reporting::TyCategory">TyCategory</a></div><div class="desc docblock-short">This is a bare signal of what kind of type we’re dealing with. <code>ty::TyKind</code> tracks
extra information about each type, but we only care about the category.</div></li><li><div class="item-name"><a class="enum" href="enum.TypeAnnotationNeeded.html" title="enum rustc_trait_selection::infer::error_reporting::TypeAnnotationNeeded">TypeAnnotationNeeded</a></div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ObligationCauseExt.html" title="trait rustc_trait_selection::infer::error_reporting::ObligationCauseExt">ObligationCauseExt</a></div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.unexpected_hidden_region_diagnostic.html" title="fn rustc_trait_selection::infer::error_reporting::unexpected_hidden_region_diagnostic">unexpected_hidden_region_diagnostic</a></div></li></ul></section></div></main></body></html>