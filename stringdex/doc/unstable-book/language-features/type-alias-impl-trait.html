<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>type_alias_impl_trait - The Rust Unstable Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-3865ffda.css">
        <link rel="stylesheet" href="../css/general-4c35105a.css">
        <link rel="stylesheet" href="../css/chrome-c0e702bf.css">
        <link rel="stylesheet" href="../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-a8d6804a.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-5989e187.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Rust Unstable Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust/tree/master/src/doc/unstable-book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust/edit/master/src/doc/unstable-book/src/language-features/type-alias-impl-trait.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="type_alias_impl_trait"><a class="header" href="#type_alias_impl_trait"><code>type_alias_impl_trait</code></a></h1>
<p>The tracking issue for this feature is: <a href="https://github.com/rust-lang/rust/issues/63063">#63063</a></p>
<hr />
<blockquote>
<p>This feature is not to be confused with <a href="./trait-alias.html"><code>trait_alias</code></a> or <a href="./impl-trait-in-assoc-type.html"><code>impl_trait_in_assoc_type</code></a>.</p>
</blockquote>
<h3 id="what-is-impl-trait"><a class="header" href="#what-is-impl-trait">What is <code>impl Trait</code>?</a></h3>
<p><code>impl Trait</code> in return position is useful for declaring types that are constrained by traits, but whose concrete type should be hidden:</p>
<pre><pre class="playground"><code class="language-rust">use std::fmt::Debug;

fn new() -&gt; impl Debug {
    42
}

fn main() {
    let thing = new();
    // What actually is a `thing`?
    // No idea but we know it implements `Debug`, so we can debug print it
    println!("{thing:?}");
}</code></pre></pre>
<p>See the <a href="https://doc.rust-lang.org/stable/reference/types/impl-trait.html#abstract-return-types">reference</a> for more information about <code>impl Trait</code> in return position.</p>
<h3 id="type_alias_impl_trait-1"><a class="header" href="#type_alias_impl_trait-1"><code>type_alias_impl_trait</code></a></h3>
<p>However, we might want to use an <code>impl Trait</code> in multiple locations but actually use the same concrete type everywhere while keeping it hidden.
This can be useful in libraries where you want to hide implementation details.</p>
<p>The <code>#[define_opaque]</code> attribute must be used to explicitly list opaque items constrained by the item it's on.</p>
<pre><pre class="playground"><code class="language-rust">#![feature(type_alias_impl_trait)]
<span class="boring">#![allow(unused_variables, dead_code)]
</span>trait Trait {}

struct MyType;

impl Trait for MyType {}

type Alias = impl Trait;

#[define_opaque(Alias)] // To constrain the type alias to `MyType`
fn new() -&gt; Alias {
    MyType
}

#[define_opaque(Alias)] // So we can name the concrete type inside this item
fn main() {
    let thing: MyType = new();
}

// It can be a part of a struct too
struct HaveAlias {
    stuff: String,
    thing: Alias,
}</code></pre></pre>
<p>In this example, the concrete type referred to by <code>Alias</code> is guaranteed to be the same wherever <code>Alias</code> occurs.</p>
<blockquote>
<p>Originally this feature included type aliases as an associated type of a trait. In <a href="https://github.com/rust-lang/rust/pull/110237">#110237</a> this was split off to <a href="./impl-trait-in-assoc-type.html"><code>impl_trait_in_assoc_type</code></a>.</p>
</blockquote>
<h3 id="type_alias_impl_trait-in-argument-position"><a class="header" href="#type_alias_impl_trait-in-argument-position"><code>type_alias_impl_trait</code> in argument position.</a></h3>
<p>Note that using <code>Alias</code> as an argument type is <em>not</em> the same as argument-position <code>impl Trait</code>, as <code>Alias</code> refers to a unique type, whereas the concrete type for argument-position <code>impl Trait</code> is chosen by the caller.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![feature(type_alias_impl_trait)]
</span><span class="boring">#![allow(unused_variables)]
</span><span class="boring">pub mod x {
</span><span class="boring">pub trait Trait {}
</span><span class="boring">
</span><span class="boring">struct MyType;
</span><span class="boring">
</span><span class="boring">impl Trait for MyType {}
</span><span class="boring">
</span><span class="boring">pub type Alias = impl Trait;
</span><span class="boring">
</span><span class="boring">#[define_opaque(Alias)]
</span><span class="boring">pub fn new() -&gt; Alias {
</span><span class="boring">    MyType
</span><span class="boring">}
</span><span class="boring">}
</span><span class="boring">use x::*;
</span>// this...
pub fn take_alias(x: Alias) {
    // ...
}

// ...is *not* the same as
pub fn take_impl(x: impl Trait) {
    // ...
}
<span class="boring">fn main(){}</span></code></pre></pre>
<pre><pre class="playground"><code class="language-rust compile_fail E0308"><span class="boring">#![feature(type_alias_impl_trait)]
</span><span class="boring">#![allow(unused_variables)]
</span><span class="boring">pub mod x {
</span><span class="boring">pub trait Trait {}
</span><span class="boring">
</span><span class="boring">struct MyType;
</span><span class="boring">
</span><span class="boring">impl Trait for MyType {}
</span><span class="boring">
</span><span class="boring">pub type Alias = impl Trait;
</span><span class="boring">
</span><span class="boring">#[define_opaque(Alias)]
</span><span class="boring">pub fn new() -&gt; Alias {
</span><span class="boring">    MyType
</span><span class="boring">}
</span><span class="boring">}
</span><span class="boring">use x::*;
</span><span class="boring">pub fn take_alias(x: Alias) {
</span><span class="boring">    // ...
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">pub fn take_impl(x: impl Trait) {
</span><span class="boring">   // ...
</span><span class="boring">}
</span><span class="boring">
</span>// a user's crate using the trait and type alias
struct UserType;
impl Trait for UserType {}

<span class="boring">fn main(){
</span>let x = UserType;
take_alias(x);
// ERROR expected opaque type, found `UserType`
// this function *actually* takes a `MyType` as is constrained in `new`

let x = UserType;
take_impl(x);
// OK

let x = new();
take_alias(x);
// OK

let x = new();
take_impl(x);
// OK
<span class="boring">}</span></code></pre></pre>
<p>Note that the user cannot use <code>#[define_opaque(Alias)]</code> to reify the opaque type because only the crate where the type alias is declared may do so. But if this happened in the same crate and the opaque type was reified, they'd get a familiar error: "expected <code>MyType</code>, got <code>UserType</code>".</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../language-features/try-blocks.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../language-features/type-changing-struct-update.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../language-features/try-blocks.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../language-features/type-changing-struct-update.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-9aeb6ddf.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-9576a2db.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
