<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate handles the user facing autodiff macro. For each `#[autodiff(...)]` attribute, we create an `AutoDiffItem` which contains the source and target function names. The source is the function to which the autodiff attribute is applied, and the target is the function getting generated by us (with a name given by the user as the first autodiff arg)."><title>rustc_ast::expand::autodiff_attrs - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../../static.files/rustdoc-b5d4dc93.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="rustc_ast" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0-dev" data-channel="nightly" data-search-js="search-1a4373a8.js" data-stringdex-js="stringdex-0e748618.js" data-settings-js="settings-c38705f0.js" ><script src="../../../static.files/storage-1b37d467.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-c7770cbf.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module autodiff_attrs</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../../rustc_ast/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-9a9549ea.svg" alt="logo"></a><h2><a href="../../../rustc_ast/index.html">rustc_<wbr>ast</a><span class="version">1.91.0-dev</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module autodiff_<wbr>attrs</a></h2><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2><a href="../index.html">In rustc_<wbr>ast::<wbr>expand</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../../index.html">rustc_ast</a>::<wbr><a href="../index.html">expand</a></div><h1>Module <span>autodiff_<wbr>attrs</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../../src/rustc_ast/expand/autodiff_attrs.rs.html#1-288">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate handles the user facing autodiff macro. For each <code>#[autodiff(...)]</code> attribute,
we create an <a href="struct.AutoDiffItem.html" title="struct rustc_ast::expand::autodiff_attrs::AutoDiffItem"><code>AutoDiffItem</code></a> which contains the source and target function names. The source
is the function to which the autodiff attribute is applied, and the target is the function
getting generated by us (with a name given by the user as the first autodiff arg).</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AutoDiffAttrs.html" title="struct rustc_ast::expand::autodiff_attrs::AutoDiffAttrs">Auto<wbr>Diff<wbr>Attrs</a></dt><dt><a class="struct" href="struct.AutoDiffItem.html" title="struct rustc_ast::expand::autodiff_attrs::AutoDiffItem">Auto<wbr>Diff<wbr>Item</a></dt><dd>We generate one of these structs for each <code>#[autodiff(...)]</code> attribute.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.DiffActivity.html" title="enum rustc_ast::expand::autodiff_attrs::DiffActivity">Diff<wbr>Activity</a></dt><dd>Dual and Duplicated (and their Only variants) are getting lowered to the same Enzyme Activity.
However, under forward mode we overwrite the previous shadow value, while for reverse mode
we add to the previous shadow value. To not surprise users, we picked different names.
Dual numbers is also a quite well known name for forward mode AD types.</dd><dt><a class="enum" href="enum.DiffMode.html" title="enum rustc_ast::expand::autodiff_attrs::DiffMode">Diff<wbr>Mode</a></dt><dd>Forward and Reverse Mode are well known names for automatic differentiation implementations.
Enzyme does support both, but with different semantics, see DiffActivity. The First variants
are a hack to support higher order derivatives. We need to compute first order derivatives
before we compute second order derivatives, otherwise we would differentiate our placeholder
functions. The proper solution is to recognize and resolve this DAG of autodiff invocations,
as it’s already done in the C++ and Julia frontend of Enzyme.</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.valid_input_activity.html" title="fn rustc_ast::expand::autodiff_attrs::valid_input_activity">valid_<wbr>input_<wbr>activity</a></dt><dt><a class="fn" href="fn.valid_ret_activity.html" title="fn rustc_ast::expand::autodiff_attrs::valid_ret_activity">valid_<wbr>ret_<wbr>activity</a></dt><dd>Active(Only) is valid in reverse-mode AD for scalar float returns (f16/f32/…).
Dual(Only) is valid in forward-mode AD for scalar float returns (f16/f32/…).
Const is valid for all cases and means that we don’t compute derivatives wrt. this output.
That usually means we have a &amp;mut or *mut T output and compute derivatives wrt. that arg,
but this is too complex to verify here. Also it’s just a logic error if users get this wrong.</dd><dt><a class="fn" href="fn.valid_ty_for_activity.html" title="fn rustc_ast::expand::autodiff_attrs::valid_ty_for_activity">valid_<wbr>ty_<wbr>for_<wbr>activity</a></dt><dd>For indirections (ptr/ref) we can’t use Active, since Active allocates a shadow value
for the given argument, but we generally can’t know the size of such a type.
For scalar types (f16/f32/f64/f128) we can use Active and we can’t use Duplicated,
since Duplicated expects a mutable ref/ptr and we would thus end up with a shadow value
who is an indirect type, which doesn’t match the primal scalar type. We can’t prevent
users here from marking scalars as Duplicated, due to type aliases.</dd></dl></section></div></main></body></html>