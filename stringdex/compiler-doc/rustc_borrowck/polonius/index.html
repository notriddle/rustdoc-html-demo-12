<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Polonius analysis and support code:"><title>rustc_borrowck::polonius - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-b5d4dc93.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rustc_borrowck" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0-dev" data-channel="nightly" data-search-js="search-88cc0424.js" data-stringdex-js="stringdex-0e748618.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-1b37d467.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-c7770cbf.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module polonius</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../rustc_borrowck/index.html"><img class="rust-logo" src="../../static.files/rust-logo-9a9549ea.svg" alt="logo"></a><h2><a href="../../rustc_borrowck/index.html">rustc_<wbr>borrowck</a><span class="version">1.91.0-dev</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module polonius</a></h2><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate rustc_<wbr>borrowck</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">rustc_borrowck</a></div><h1>Module <span>polonius</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/rustc_borrowck/polonius/mod.rs.html#1-194">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Polonius analysis and support code:</p>
<ul>
<li>dedicated constraints</li>
<li>conversion from NLL constraints</li>
<li>debugging utilities</li>
<li>etc.</li>
</ul>
<p>The current implementation models the flow-sensitive borrow-checking concerns as a graph
containing both information about regions and information about the control flow.</p>
<p>Loan propagation is seen as a reachability problem (with some subtleties) between where the loan
is introduced and a given point.</p>
<p>Constraints arising from type-checking allow loans to flow from region to region at the same CFG
point. Constraints arising from liveness allow loans to flow within from point to point, between
live regions at these points.</p>
<p>Edges can be bidirectional to encode invariant relationships, and loans can flow â€œback in timeâ€
to traverse these constraints arising earlier in the CFG.</p>
<p>When incorporating kills in the traversal, the loans reaching a given point are considered live.</p>
<p>After this, the usual NLL process happens. These live loans are fed into a dataflow analysis
combining them with the points where loans go out of NLL scope (the frontier where they stop
propagating to a live region), to yield the â€œloans in scopeâ€ or â€œactive loansâ€, at a given
point.</p>
<p>Illegal accesses are still computed by checking whether one of these resulting loans is
invalidated.</p>
<p>More information on this simple approach can be found in the following links, and in the future
in the rustc dev guide:</p>
<ul>
<li><a href="https://smallcultfollowing.com/babysteps/blog/2023/09/22/polonius-part-1/">https://smallcultfollowing.com/babysteps/blog/2023/09/22/polonius-part-1/</a></li>
<li><a href="https://smallcultfollowing.com/babysteps/blog/2023/09/29/polonius-part-2/">https://smallcultfollowing.com/babysteps/blog/2023/09/29/polonius-part-2/</a></li>
</ul>
<p>Data flows like this:</p>
<ol>
<li>during MIR typeck, record liveness data needed later: live region variances, as well as the
usual NLL liveness data (just computed on more locals). Thatâ€™s the <a href="struct.PoloniusLivenessContext.html" title="struct rustc_borrowck::polonius::PoloniusLivenessContext">PoloniusLivenessContext</a>.</li>
<li>once that is done, variance data is transferred, and the NLL region liveness is converted to
the polonius shape. Thatâ€™s the main <a href="struct.PoloniusContext.html" title="struct rustc_borrowck::polonius::PoloniusContext">PoloniusContext</a>.</li>
<li>during region inference, that data and the NLL outlives constraints are used to create the
localized outlives constraints, as described above. Thatâ€™s the <a href="struct.PoloniusDiagnosticsContext.html" title="struct rustc_borrowck::polonius::PoloniusDiagnosticsContext">PoloniusDiagnosticsContext</a>.</li>
<li>transfer this back to the main borrowck procedure: it handles computing errors and
diagnostics, debugging and MIR dumping concerns.</li>
</ol>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="constraints/index.html" title="mod rustc_borrowck::polonius::constraints">constraints</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="dump/index.html" title="mod rustc_borrowck::polonius::dump">dump</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="legacy/index.html" title="mod rustc_borrowck::polonius::legacy">legacy</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Functions dedicated to fact generation for the <code>-Zpolonius=legacy</code> datalog implementation.</dd><dt><a class="mod" href="liveness_constraints/index.html" title="mod rustc_borrowck::polonius::liveness_constraints">liveness_<wbr>constraints</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="loan_liveness/index.html" title="mod rustc_borrowck::polonius::loan_liveness">loan_<wbr>liveness</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="typeck_constraints/index.html" title="mod rustc_borrowck::polonius::typeck_constraints">typeck_<wbr>constraints</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.PoloniusContext.html" title="struct rustc_borrowck::polonius::PoloniusContext">Polonius<wbr>Context</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>This struct holds the data needed to create the Polonius localized constraints. Its data is
transferred and converted from the <a href="struct.PoloniusLivenessContext.html" title="struct rustc_borrowck::polonius::PoloniusLivenessContext">PoloniusLivenessContext</a> at the end of MIR typeck.</dd><dt><a class="struct" href="struct.PoloniusDiagnosticsContext.html" title="struct rustc_borrowck::polonius::PoloniusDiagnosticsContext">Polonius<wbr>Diagnostics<wbr>Context</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>This struct holds the data needed by the borrowck error computation and diagnostics. Its data is
computed from the <a href="struct.PoloniusContext.html" title="struct rustc_borrowck::polonius::PoloniusContext">PoloniusContext</a> when computing NLL regions.</dd><dt><a class="struct" href="struct.PoloniusLivenessContext.html" title="struct rustc_borrowck::polonius::PoloniusLivenessContext">Polonius<wbr>Liveness<wbr>Context</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>This struct holds the liveness data created during MIR typeck, and which will be used later in
the process, to compute the polonius localized constraints.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.ConstraintDirection.html" title="enum rustc_borrowck::polonius::ConstraintDirection">Constraint<wbr>Direction</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>The direction a constraint can flow into. Used to create liveness constraints according to
variance.</dd></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="type" href="type.LiveLoans.html" title="type rustc_borrowck::polonius::LiveLoans">Live<wbr>Loans</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl></section></div></main></body></html>