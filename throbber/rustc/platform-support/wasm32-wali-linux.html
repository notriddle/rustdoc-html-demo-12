<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>wasm32-wali-linux-musl - The rustc book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-3865ffda.css">
        <link rel="stylesheet" href="../css/general-4c35105a.css">
        <link rel="stylesheet" href="../css/chrome-c0e702bf.css">
        <link rel="stylesheet" href="../css/print-ad67d350.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome-799aeb25.css">
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight-56612340.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/pagetoc-88f5e8d1.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-8f7d732b.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-95435adc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The rustc book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust/tree/master/src/doc/rustc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/rust-lang/rust/edit/master/src/doc/rustc/src/platform-support/wasm32-wali-linux.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="wasm32-wali-linux-"><a class="header" href="#wasm32-wali-linux-"><code>wasm32-wali-linux-*</code></a></h1>
<p><strong>Tier: 3</strong></p>
<p>WebAssembly targets that use the <a href="https://github.com/arjunr2/WALI">WebAssembly Linux Interface (WALI)</a> with 32-bit memory. The latest status of the WALI specification and support are documented within the repo.</p>
<p>WALI offers seamless targetability of traditional Linux applications to Wasm by exposing Linux syscalls strategically into the sandbox. Numerous applications and build system work unmodified over WALI, including complex low-level system libraries -- a list of applications are included in the research paper linked in the main repo.</p>
<p>From the wider Wasm ecosystem perspective, implementing WALI within engines allows layering of high-level security policies (e.g. WASI) above it, arming the latter's implementations with sandboxing and portability.</p>
<h2 id="target-maintainers"><a class="header" href="#target-maintainers">Target maintainers</a></h2>
<p><a href="https://github.com/arjunr2">@arjunr2</a></p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<h3 id="compilation"><a class="header" href="#compilation">Compilation</a></h3>
<p>This target is cross-compiled and requires an installation of the <a href="https://github.com/arjunr2/WALI">WALI compiler/sysroot</a>. This produces standard <code>wasm32</code> binaries with the WALI interface methods as module imports that need to be implemented by a supported engine (see the  "Execution" section below).</p>
<p><code>wali</code> targets <em>minimally require</em> the following LLVM feature flags:</p>
<ul>
<li><a href="https://github.com/WebAssembly/spec/blob/main/proposals/bulk-memory-operations/Overview.md">Bulk memory</a> - <code>+bulk-memory</code></li>
<li>Mutable imported globals - <code>+mutable-globals</code></li>
<li><a href="https://github.com/WebAssembly/spec/blob/main/proposals/sign-extension-ops/Overview.md">Sign-extending operations</a> - <code>+sign-ext</code></li>
<li><a href="https://github.com/WebAssembly/threads/blob/main/proposals/threads/Overview.md">Threading/Atomics</a> - <code>+atomics</code></li>
</ul>
<blockquote>
<p><strong>Note</strong>: Users can expect that new enabled-by-default Wasm features for LLVM are transitively incorporatable into this target -- see <a href="wasm32-unknown-unknown.html">wasm32-unknown-unknown</a> for detailed information on WebAssembly features.</p>
</blockquote>
<blockquote>
<p><strong>Note</strong>: The WALI ABI is similar to default Clang wasm32 ABIs but <em>not identical</em>. The primary difference is 64-bit <code>long</code> types as opposed to 32-bit for wasm32. This is required to maintain minimum source code changes for 64-bit host platforms currently supported. This may change in the future as the spec evolves.</p>
</blockquote>
<h3 id="execution"><a class="header" href="#execution">Execution</a></h3>
<p>Running generated WALI binaries also requires a supported compliant engine implementation -- a working implementation in the <a href="https://github.com/arjunr2/WALI">WebAssembly Micro-Runtime (WAMR)</a> is included in the repo.</p>
<blockquote>
<p><strong>Note</strong>: WALI is still somewhat experimental and bugs may exist in the Rust support, WALI toolchain, or the LLVM compiler. The former can be filed in Rust repos while the latter two in the WALI repo.</p>
</blockquote>
<h2 id="building-the-target"><a class="header" href="#building-the-target">Building the target</a></h2>
<p>You can build Rust with support for the target by adding it to the <code>target</code>
list in <code>config.toml</code>, and pointing to the toolchain artifacts from the previous section ("Requirements-&gt;Compilation"). A sample <code>config.toml</code> for the <code>musl</code> environment will look like this, where <code>&lt;WALI-root&gt;</code> is the absolute path to the root directory of the <a href="https://github.com/arjunr2/WALI">WALI repo</a>:</p>
<pre><code class="language-toml">[build]
target = ["wasm32-wali-linux-musl"]

[target.wasm32-wali-linux-musl]
musl-root = "&lt;WALI&gt;/wali-musl/sysroot"
llvm-config = "&lt;WALI&gt;/llvm-project/build/bin/llvm-config"
cc = "&lt;WALI&gt;/llvm-project/build/bin/clang-18"
cxx = "&lt;WALI&gt;/llvm-project/build/bin/clang-18"
ar = "&lt;WALI&gt;/llvm-project/build/bin/llvm-ar"
ranlib = "&lt;WALI&gt;/llvm-project/build/bin/llvm-ranlib"
llvm-libunwind = "system"
crt-static = true
</code></pre>
<blockquote>
<p>The <code>llvm-config</code> settings are only temporary, and the changes will eventually be upstreamed into LLVM</p>
</blockquote>
<h2 id="building-rust-programs"><a class="header" href="#building-rust-programs">Building Rust programs</a></h2>
<p>Rust does not yet ship pre-compiled artifacts for this target. To compile for
this target, you will either need to build Rust with the target enabled (see
"Building the target" above), or build your own copy of <code>core</code> by using
<code>build-std</code> or similar.</p>
<p>Rust program builds can use this target normally. Currently, linking WALI programs may require pointing the <code>linker</code> to the llvm build in the <a href="https://doc.rust-lang.org/cargo/reference/config.html">Cargo config</a> (until LLVM is upstreamed). A <code>config.toml</code> for Cargo will look like the following:</p>
<pre><code class="language-toml">[target.wasm32-wali-linux-musl]
linker = "&lt;WALI&gt;/llvm-project/build/bin/lld"
</code></pre>
<p>Note that the following <code>cfg</code> directives are set for <code>wasm32-wali-linux-*</code>:</p>
<ul>
<li><code>cfg(target_arch = "wasm32")</code></li>
<li><code>cfg(target_family = {"wasm", "unix"})</code></li>
<li><code>cfg(target_r = "wasm")</code></li>
<li><code>cfg(target_os = "linux")</code></li>
<li><code>cfg(target_env = *)</code></li>
</ul>
<h3 id="restrictions"><a class="header" href="#restrictions">Restrictions</a></h3>
<p>Hardware or platform-specific support, besides <code>syscall</code> is mostly unsupported in WALI for ISA portability (these tend to be uncommon).</p>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<p>Currently testing is not supported for <code>wali</code> targets and the Rust project doesn't run any tests for this target.</p>
<p>However, standard ISA-agnostic tests for Linux should be thereotically reusable for WALI targets and minor changes. Testing integration will be continually incorporated as support evolves.</p>
<h2 id="cross-compilation-toolchains-and-c-code"><a class="header" href="#cross-compilation-toolchains-and-c-code">Cross-compilation toolchains and C code</a></h2>
<p>Most fully featured C code is compilable with the WALI toolchain -- examples can be seen in the repo.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../platform-support/wasm32-wasip2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../platform-support/wasm32-unknown-emscripten.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../platform-support/wasm32-wasip2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../platform-support/wasm32-unknown-emscripten.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-9aeb6ddf.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-9576a2db.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/pagetoc-ad825849.js"></script>



    </div>
    </body>
</html>
