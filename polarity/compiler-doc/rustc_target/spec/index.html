<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Flexible target specification."><title>rustc_target::spec - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-e56847b5.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="rustc_target" data-themes="" data-resource-suffix="" data-rustdoc-version="1.91.0-dev" data-channel="nightly" data-search-js="search-38ac1f3e.js" data-stringdex-js="stringdex-0e748618.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-6dc2a7f3.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module spec</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../rustc_target/index.html"><img class="rust-logo" src="../../static.files/rust-logo-9a9549ea.svg" alt="logo"></a><h2><a href="../../rustc_target/index.html">rustc_<wbr>target</a><span class="version">1.91.0-dev</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module spec</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#using-targets-and-targetjson" title="Using targets and target.json">Using targets and target.json</a></li><li><a href="#defining-a-new-target" title="Defining a new target">Defining a new target</a></li></ul><h3><a href="#modules">Module Items</a></h3><ul class="block"><li><a href="#modules" title="Modules">Modules</a></li><li><a href="#macros" title="Macros">Macros</a></li><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#statics" title="Statics">Statics</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li><li><a href="#types" title="Type Aliases">Type Aliases</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate rustc_<wbr>target</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">rustc_target</a></div><h1>Module <span>spec</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/rustc_target/spec/mod.rs.html#1-3824">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p><a href="https://github.com/rust-lang/rfcs/pull/131">Flexible target specification.</a></p>
<p>Rust targets a wide variety of usecases, and in the interest of flexibility,
allows new target tuples to be defined in configuration files. Most users
will not need to care about these, but this is invaluable when porting Rust
to a new platform, and allows for an unprecedented level of control over how
the compiler works.</p>
<h2 id="using-targets-and-targetjson"><a class="doc-anchor" href="#using-targets-and-targetjson">Â§</a>Using targets and target.json</h2>
<p>Invoking â€œrustc â€“target=${TUPLE}â€ will result in rustc initiating the <a href="struct.Target.html#method.search" title="associated function rustc_target::spec::Target::search"><code>Target::search</code></a> by</p>
<ul>
<li>checking if â€œ$TUPLEâ€ is a complete path to a json (ending with â€œ.jsonâ€) and loading if so</li>
<li>checking builtin targets for â€œ${TUPLE}â€</li>
<li>checking directories in â€œ${RUST_TARGET_PATH}â€ for â€œ${TUPLE}.jsonâ€</li>
<li>checking for â€œ${RUSTC_SYSROOT}/lib/rustlib/${TUPLE}/target.jsonâ€</li>
</ul>
<p>Code will then be compiled using the first discovered target spec.</p>
<h2 id="defining-a-new-target"><a class="doc-anchor" href="#defining-a-new-target">Â§</a>Defining a new target</h2>
<p>Targets are defined using a struct which additionally has serialization to and from <a href="https://json.org">JSON</a>.
The <code>Target</code> struct in this module loosely corresponds with the format the JSON takes.
We usually try to make the fields equivalent but we have given up on a 1:1 correspondence
between the JSON and the actual structure itself.</p>
<p>Some fields are required in every target spec, and they should be embedded in Target directly.
Optional keys are in TargetOptions, but Target derefs to it, for no practical difference.
Most notable is the â€œdata-layoutâ€ field which specifies Rustâ€™s notion of sizes and alignments
for several key types, such as f64, pointers, and so on.</p>
<p>At one point we felt <code>-C</code> options should override the targetâ€™s settings, like in C compilers,
but that was an essentially-unmarked route for making code incorrect and Rust unsound.
Confronted with programmers who prefer a compiler with a good UX instead of a lethal weapon,
we have almost-entirely recanted that notion, though we hope â€œtarget modifiersâ€ will offer
a way to have a decent UX yet still extend the necessary compiler controls, without
requiring a new target spec for each and every single possible target micro-variant.</p>
</div></details><h2 id="modules" class="section-header">Modules<a href="#modules" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="mod" href="abi_map/index.html" title="mod rustc_target::spec::abi_map">abi_map</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="apple/index.html" title="mod rustc_target::spec::apple">apple</a></dt><dt><a class="mod" href="base/index.html" title="mod rustc_target::spec::base">base</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="crt_objects/index.html" title="mod rustc_target::spec::crt_objects">crt_<wbr>objects</a></dt><dd>Object files providing support for basic runtime facilities and added to the produced binaries
at the start and at the end of linking.</dd><dt><a class="mod" href="json/index.html" title="mod rustc_target::spec::json">json</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="mod" href="targets/index.html" title="mod rustc_target::spec::targets">targets</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="macros" class="section-header">Macros<a href="#macros" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="macro" href="macro.cvs.html" title="macro rustc_target::spec::cvs">cvs</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Cow-Vec-Str: Cow&lt;â€™static, [Cow&lt;â€™static, str&gt;]&gt;</dd><dt><a class="macro" href="macro.linker_flavor_cli_impls.html" title="macro rustc_target::spec::linker_flavor_cli_impls">linker_<wbr>flavor_<wbr>cli_<wbr>impls</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="macro" href="macro.supported_targets.html" title="macro rustc_target::spec::supported_targets">supported_<wbr>targets</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="struct" href="struct.AbiMap.html" title="struct rustc_target::spec::AbiMap">AbiMap</a></dt><dd>Mapping for ExternAbi to CanonAbi according to a Target</dd><dt><a class="struct" href="struct.LinkSelfContainedComponents.html" title="struct rustc_target::spec::LinkSelfContainedComponents">Link<wbr>Self<wbr>Contained<wbr>Components</a></dt><dd>The <code>-C link-self-contained</code> components that can individually be enabled or disabled.</dd><dt><a class="struct" href="struct.LinkerFeatures.html" title="struct rustc_target::spec::LinkerFeatures">Linker<wbr>Features</a></dt><dd>The <code>-C linker-features</code> components that can individually be enabled or disabled.</dd><dt><a class="struct" href="struct.SanitizerSet.html" title="struct rustc_target::spec::SanitizerSet">Sanitizer<wbr>Set</a></dt><dt><a class="struct" href="struct.Target.html" title="struct rustc_target::spec::Target">Target</a></dt><dd>Everything <code>rustc</code> knows about how to compile for a specific target.</dd><dt><a class="struct" href="struct.TargetMetadata.html" title="struct rustc_target::spec::TargetMetadata">Target<wbr>Metadata</a></dt><dd>Metadata about a target like the description or tier.
Part of #120745.
All fields are optional for now, but intended to be required in the future.</dd><dt><a class="struct" href="struct.TargetOptions.html" title="struct rustc_target::spec::TargetOptions">Target<wbr>Options</a></dt><dd>Optional aspects of a target specification.</dd><dt><a class="struct" href="struct.TargetWarnings.html" title="struct rustc_target::spec::TargetWarnings">Target<wbr>Warnings</a></dt><dd>Warnings encountered when parsing the target <code>json</code>.</dd><dt><a class="struct" href="struct.X86Abi.html" title="struct rustc_target::spec::X86Abi">X86Abi</a></dt><dd>x86 (32-bit) abi options.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.AbiMapping.html" title="enum rustc_target::spec::AbiMapping">AbiMapping</a></dt><dd>result from trying to map an ABI</dd><dt><a class="enum" href="enum.BinaryFormat.html" title="enum rustc_target::spec::BinaryFormat">Binary<wbr>Format</a></dt><dt><a class="enum" href="enum.Cc.html" title="enum rustc_target::spec::Cc">Cc</a></dt><dd>Linker is called through a C/C++ compiler.</dd><dt><a class="enum" href="enum.CodeModel.html" title="enum rustc_target::spec::CodeModel">Code<wbr>Model</a></dt><dt><a class="enum" href="enum.DebuginfoKind.html" title="enum rustc_target::spec::DebuginfoKind">Debuginfo<wbr>Kind</a></dt><dd>Which kind of debuginfo does the target use?</dd><dt><a class="enum" href="enum.FloatAbi.html" title="enum rustc_target::spec::FloatAbi">Float<wbr>Abi</a></dt><dd>The float ABI setting to be configured in the LLVM target machine.</dd><dt><a class="enum" href="enum.FramePointer.html" title="enum rustc_target::spec::FramePointer">Frame<wbr>Pointer</a></dt><dt><a class="enum" href="enum.LinkOutputKind.html" title="enum rustc_target::spec::LinkOutputKind">Link<wbr>Output<wbr>Kind</a></dt><dd>Everything is flattened to a single enum to make the json encoding/decoding less annoying.</dd><dt><a class="enum" href="enum.LinkSelfContainedDefault.html" title="enum rustc_target::spec::LinkSelfContainedDefault">Link<wbr>Self<wbr>Contained<wbr>Default</a></dt><dd>The different <code>-Clink-self-contained</code> options that can be specified in a target spec:</dd><dt><a class="enum" href="enum.LinkerFlavor.html" title="enum rustc_target::spec::LinkerFlavor">Linker<wbr>Flavor</a></dt><dd>All linkers have some kinds of command line interfaces and rustc needs to know which commands
to use with each of them. So we cluster all such interfaces into a (somewhat arbitrary) number
of classes that we call â€œlinker flavorsâ€.</dd><dt><a class="enum" href="enum.LinkerFlavorCli.html" title="enum rustc_target::spec::LinkerFlavorCli">Linker<wbr>Flavor<wbr>Cli</a></dt><dd>Linker flavors available externally through command line (<code>-Clinker-flavor</code>)
or json target specifications.
This set has accumulated historically, and contains both (stable and unstable) legacy values, as
well as modern ones matching the internal linker flavors (<code>LinkerFlavor</code>).</dd><dt><a class="enum" href="enum.Lld.html" title="enum rustc_target::spec::Lld">Lld</a></dt><dd>Linker is LLD.</dd><dt><a class="enum" href="enum.LldFlavor.html" title="enum rustc_target::spec::LldFlavor">LldFlavor</a></dt><dt><a class="enum" href="enum.MergeFunctions.html" title="enum rustc_target::spec::MergeFunctions">Merge<wbr>Functions</a></dt><dt><a class="enum" href="enum.OnBrokenPipe.html" title="enum rustc_target::spec::OnBrokenPipe">OnBroken<wbr>Pipe</a></dt><dt><a class="enum" href="enum.PanicStrategy.html" title="enum rustc_target::spec::PanicStrategy">Panic<wbr>Strategy</a></dt><dt><a class="enum" href="enum.RelocModel.html" title="enum rustc_target::spec::RelocModel">Reloc<wbr>Model</a></dt><dt><a class="enum" href="enum.RelroLevel.html" title="enum rustc_target::spec::RelroLevel">Relro<wbr>Level</a></dt><dt><a class="enum" href="enum.RustcAbi.html" title="enum rustc_target::spec::RustcAbi">Rustc<wbr>Abi</a></dt><dd>The Rustc-specific variant of the ABI used for this target.</dd><dt><a class="enum" href="enum.SmallDataThresholdSupport.html" title="enum rustc_target::spec::SmallDataThresholdSupport">Small<wbr>Data<wbr>Threshold<wbr>Support</a></dt><dt><a class="enum" href="enum.SplitDebuginfo.html" title="enum rustc_target::spec::SplitDebuginfo">Split<wbr>Debuginfo</a></dt><dt><a class="enum" href="enum.StackProbeType.html" title="enum rustc_target::spec::StackProbeType">Stack<wbr>Probe<wbr>Type</a></dt><dt><a class="enum" href="enum.StackProtector.html" title="enum rustc_target::spec::StackProtector">Stack<wbr>Protector</a></dt><dd>Controls use of stack canaries.</dd><dt><a class="enum" href="enum.SymbolVisibility.html" title="enum rustc_target::spec::SymbolVisibility">Symbol<wbr>Visibility</a></dt><dt><a class="enum" href="enum.TargetKind.html" title="enum rustc_target::spec::TargetKind">Target<wbr>Kind</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>For the <a href="struct.Target.html#method.check_consistency" title="method rustc_target::spec::Target::check_consistency"><code>Target::check_consistency</code></a> function, determines whether the given target is a builtin or a JSON
target.</dd><dt><a class="enum" href="enum.TargetTuple.html" title="enum rustc_target::spec::TargetTuple">Target<wbr>Tuple</a></dt><dd>Either a target tuple string or a path to a JSON file.</dd><dt><a class="enum" href="enum.TlsModel.html" title="enum rustc_target::spec::TlsModel">TlsModel</a></dt></dl><h2 id="statics" class="section-header">Statics<a href="#statics" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="static" href="static.TARGETS.html" title="static rustc_target::spec::TARGETS">TARGETS</a></dt><dd>List of supported targets</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="trait" href="trait.HasTargetSpec.html" title="trait rustc_target::spec::HasTargetSpec">HasTarget<wbr>Spec</a></dt><dt><a class="trait" href="trait.HasX86AbiOpt.html" title="trait rustc_target::spec::HasX86AbiOpt">HasX86<wbr>AbiOpt</a></dt></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="fn" href="fn.add_link_args.html" title="fn rustc_target::spec::add_link_args">add_<wbr>link_<wbr>args</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.add_link_args_iter.html" title="fn rustc_target::spec::add_link_args_iter">add_<wbr>link_<wbr>args_<wbr>iter</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dd>Add arguments for the given flavor and also for its â€œtwinâ€ flavors
that have a compatible command line interface.</dd><dt><a class="fn" href="fn.ef_avr_arch.html" title="fn rustc_target::spec::ef_avr_arch">ef_<wbr>avr_<wbr>arch</a></dt><dd>Resolve the value of the EF_AVR_ARCH field for AVR ELF files, given the
name of the target CPU / MCU.</dd><dt><a class="fn" href="fn.load_all_builtins.html" title="fn rustc_target::spec::load_all_builtins">load_<wbr>all_<wbr>builtins</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt><dt><a class="fn" href="fn.load_builtin.html" title="fn rustc_target::spec::load_builtin">load_<wbr>builtin</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl><h2 id="types" class="section-header">Type Aliases<a href="#types" class="anchor">Â§</a></h2><dl class="item-table"><dt><a class="type" href="type.LinkArgs.html" title="type rustc_target::spec::LinkArgs">Link<wbr>Args</a></dt><dt><a class="type" href="type.LinkArgsCli.html" title="type rustc_target::spec::LinkArgsCli">Link<wbr>Args<wbr>Cli</a></dt><dt><a class="type" href="type.StaticCow.html" title="type rustc_target::spec::StaticCow">Static<wbr>Cow</a><span title="Restricted Visibility">&nbsp;ğŸ”’</span> </dt></dl></section></div></main></body></html>