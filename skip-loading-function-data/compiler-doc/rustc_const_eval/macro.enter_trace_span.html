<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Shortand for calling crate::interpret::Machine::enter_trace_span on a tracing::info_span!. This is supposed to be compiled out when crate::interpret::Machine::enter_trace_span has the default implementation (i.e. when it does not actually enter the span but instead returns `()`). This macro takes a type implementing the crate::interpret::Machine trait as its first argument and otherwise accepts the same syntax as tracing::span! (see some tips below). Note: the result of this macro must be used because the span is exited when it’s dropped."><title>enter_trace_span in rustc_const_eval - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-aa0817cf.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="rustc_const_eval" data-themes="" data-resource-suffix="" data-rustdoc-version="1.90.0-beta.1 (788da80fc 2025-08-04)" data-channel="beta" data-search-js="search-fa3e91e5.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-68b7e25d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-eebb9057.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-32bb7600.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc macro"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../rustc_const_eval/index.html"><img class="rust-logo" src="../static.files/rust-logo-9a9549ea.svg" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../rustc_const_eval/index.html"><img class="rust-logo" src="../static.files/rust-logo-9a9549ea.svg" alt="logo"></a><h2><a href="../rustc_const_eval/index.html">rustc_<wbr>const_<wbr>eval</a><span class="version">1.91.0-dev</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">enter_<wbr>trace_<wbr>span</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#syntax-accepted-by-this-macro" title="Syntax accepted by this macro">Syntax accepted by this macro</a></li><li><a href="#namesubname-syntax" title="`NAME::SUBNAME` syntax"><code>NAME::SUBNAME</code> syntax</a></li><li><a href="#tracing_separate_thread-parameter" title="`tracing_separate_thread` parameter"><code>tracing_separate_thread</code> parameter</a></li><li><a href="#executing-something-else-when-tracing-is-disabled" title="Executing something else when tracing is disabled">Executing something else when tracing is disabled</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="index.html">In crate rustc_<wbr>const_<wbr>eval</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="index.html">rustc_const_eval</a></div><h1>Macro <span class="macro">enter_trace_span</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/rustc_const_eval/interpret/util.rs.html#143-151">Source</a> </span></div><pre class="rust item-decl"><code>macro_rules! enter_trace_span {
    ($machine:ty, $name:ident :: $subname:ident $($tt:tt)*) =&gt; { ... };
    ($machine:ty, $($tt:tt)*) =&gt; { ... };
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Shortand for calling <a href="interpret/trait.Machine.html#method.enter_trace_span" title="associated function rustc_const_eval::interpret::Machine::enter_trace_span">crate::interpret::Machine::enter_trace_span</a> on a <a href="https://docs.rs/tracing/0.1.37/tracing/macro.info_span.html" title="macro tracing::info_span">tracing::info_span!</a>.
This is supposed to be compiled out when <a href="interpret/trait.Machine.html#method.enter_trace_span" title="associated function rustc_const_eval::interpret::Machine::enter_trace_span">crate::interpret::Machine::enter_trace_span</a> has the
default implementation (i.e. when it does not actually enter the span but instead returns <code>()</code>).
This macro takes a type implementing the <a href="interpret/trait.Machine.html" title="trait rustc_const_eval::interpret::Machine">crate::interpret::Machine</a> trait as its first argument
and otherwise accepts the same syntax as <a href="https://docs.rs/tracing/0.1.37/tracing/macro.span.html" title="macro tracing::span">tracing::span!</a> (see some tips below).
Note: the result of this macro <strong>must be used</strong> because the span is exited when it’s dropped.</p>
<h4 id="syntax-accepted-by-this-macro"><a class="doc-anchor" href="#syntax-accepted-by-this-macro">§</a>Syntax accepted by this macro</h4>
<p>The full documentation for the <a href="https://docs.rs/tracing/0.1.37/tracing/macro.span.html" title="macro tracing::span">tracing::span!</a> syntax can be found at <a href="https://docs.rs/tracing/0.1.37/tracing/index.html" title="mod tracing">tracing</a> under “Using the
Macros”. A few possibly confusing syntaxes are listed here:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// logs a span named "hello" with a field named "arg" of value 42 (works only because
// 42 implements the tracing::Value trait, otherwise use one of the options below)
</span><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, <span class="string">"hello"</span>, arg = <span class="number">42</span>);
<span class="comment">// logs a field called "my_display_var" using the Display implementation
</span><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, <span class="string">"hello"</span>, %my_display_var);
<span class="comment">// logs a field called "my_debug_var" using the Debug implementation
</span><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, <span class="string">"hello"</span>, <span class="question-mark">?</span>my_debug_var);</code></pre></div>
<h4 id="namesubname-syntax"><a class="doc-anchor" href="#namesubname-syntax">§</a><code>NAME::SUBNAME</code> syntax</h4>
<p>In addition to the syntax accepted by <a href="https://docs.rs/tracing/0.1.37/tracing/macro.span.html" title="macro tracing::span">tracing::span!</a>, this macro optionally allows passing
the span name (i.e. the first macro argument) in the form <code>NAME::SUBNAME</code> (without quotes) to
indicate that the span has name “NAME” (usually the name of the component) and has an additional
more specific name “SUBNAME” (usually the function name). The latter is passed to the <a href="https://docs.rs/tracing/0.1.37/tracing/index.html" title="mod tracing">tracing</a>
infrastructure as a span field with the name “NAME”. This allows not being distracted by
subnames when looking at the trace in <a href="https://ui.perfetto.dev">https://ui.perfetto.dev</a>, but when deeper introspection
is needed within a component, it’s still possible to view the subnames directly in the UI by
selecting a span, clicking on the “NAME” argument on the right, and clicking on “Visualize
argument values”.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// for example, the first will expand to the second
</span><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, borrow_tracker::on_stack_pop, <span class="comment">/* ... */</span>);
<span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, <span class="string">"borrow_tracker"</span>, borrow_tracker = <span class="string">"on_stack_pop"</span>, <span class="comment">/* ... */</span>);</code></pre></div>
<h4 id="tracing_separate_thread-parameter"><a class="doc-anchor" href="#tracing_separate_thread-parameter">§</a><code>tracing_separate_thread</code> parameter</h4>
<p>This macro was introduced to obtain better traces of Miri without impacting release performance.
Miri saves traces using the the <code>tracing_chrome</code> <code>tracing::Layer</code> so that they can be visualized
in <a href="https://ui.perfetto.dev">https://ui.perfetto.dev</a>. To instruct <code>tracing_chrome</code> to put some spans on a separate trace
thread/line than other spans when viewed in <a href="https://ui.perfetto.dev">https://ui.perfetto.dev</a>, you can pass
<code>tracing_separate_thread = tracing::field::Empty</code> to the tracing macros. This is useful to
separate out spans which just indicate the current step or program frame being processed by the
interpreter. You should use a value of <a href="https://docs.rs/tracing-core/0.1.22/tracing_core/field/struct.Empty.html" title="struct tracing_core::field::Empty">tracing::field::Empty</a> so that other tracing layers
(e.g. the logger) will ignore the <code>tracing_separate_thread</code> field. For example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, step::eval_statement, tracing_separate_thread = tracing::field::Empty);</code></pre></div>
<h4 id="executing-something-else-when-tracing-is-disabled"><a class="doc-anchor" href="#executing-something-else-when-tracing-is-disabled">§</a>Executing something else when tracing is disabled</h4>
<p><a href="interpret/trait.Machine.html#method.enter_trace_span" title="associated function rustc_const_eval::interpret::Machine::enter_trace_span">crate::interpret::Machine::enter_trace_span</a> returns <a href="interpret/trait.EnteredTraceSpan.html" title="trait rustc_const_eval::interpret::EnteredTraceSpan">EnteredTraceSpan</a>, on which you can call
<a href="interpret/trait.EnteredTraceSpan.html#tymethod.or_if_tracing_disabled" title="method rustc_const_eval::interpret::EnteredTraceSpan::or_if_tracing_disabled">EnteredTraceSpan::or_if_tracing_disabled</a>, to e.g. log a line as an alternative to the tracing
span for when tracing is disabled. For example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>_trace = <span class="macro">enter_trace_span!</span>(M, step::eval_statement)
    .or_if_tracing_disabled(|| <span class="macro">tracing::info!</span>(<span class="string">"eval_statement"</span>));</code></pre></div>
</div></details></section></div></main></body></html>